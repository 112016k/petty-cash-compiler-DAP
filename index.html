<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Petty Cash Compiler</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Petty Cash Compiler</h1>
    <p>Track multiple petty cash accounts with expenses.</p>

    <div class="setup">
        <label>Select Account:</label>
        <select id="accountSelect" onchange="switchAccount()">
            <option value="">-- Select Account --</option>
        </select>
    </div>

    <div class="setup">
        <h3>Create New Account</h3>
        <input type="text" id="newAccountName" placeholder="Account name (e.g. A1)" />
        <input type="number" id="newAccountCash" placeholder="Starting cash" />
        <button onclick="createAccount()">Create Account</button>
    </div>

    <div class="setup">
        <h3>Manage Account</h3>
        <input type="number" id="addCashAmount" placeholder="Amount to add" />
        <button onclick="addCash()">Add Cash</button>
        <button onclick="resetRecent()">Reset Expenses</button>
        <button onclick="resetAll()">Reset All (Balance & Expenses)</button>
        <button onclick="deleteAccount()">Delete Account</button>
    </div>

    <form onsubmit="addExpense(event)">
        <h3>Add Expense</h3>
        <input type="date" id="date" required />
        <input type="text" id="description" placeholder="Description" required />
        <input type="number" id="amount" placeholder="Amount" required />
        <button type="submit">Add Expense</button>
    </form>

    <div class="summary">
        <p><strong>Total Spent:</strong> â‚±<span id="totalSpent">0.00</span></p>
        <p><strong>Remaining Balance:</strong> â‚±<span id="remaining">0.00</span></p>
    </div>

    <table>
        <thead>
            <tr><th>Date</th><th>Description</th><th>Amount</th></tr>
        </thead>
        <tbody id="expenseTable"></tbody>
    </table>

    <button onclick="downloadCSV()" class="download-btn">Download CSV</button>

    <button onclick="toggleDarkMode()" class="toggle-dark-mode-btn">ðŸŒ™</button>

    <script>
        let accounts = JSON.parse(localStorage.getItem('accounts')) || {};
        let currentAccount = null;

        window.onload = () => loadAccountOptions();

        function loadAccountOptions() {
            const select = document.getElementById('accountSelect');
            select.innerHTML = '<option value="">-- Select Account --</option>';
            for (let name in accounts) {
                let opt = document.createElement('option');
                opt.value = name;
                opt.textContent = name;
                select.appendChild(opt);
            }
            if (currentAccount && accounts[currentAccount]) {
                select.value = currentAccount;
                updateUI();
            } else {
                clearUI();
            }
        }

        function createAccount() {
            const name = document.getElementById('newAccountName').value.trim();
            const cash = parseFloat(document.getElementById('newAccountCash').value);
            if (!name || isNaN(cash)) return alert("Provide valid account name & cash.");
            if (accounts[name]) return alert("Account exists!");
            accounts[name] = { startingCash: cash, expenses: [] };
            save();
            currentAccount = name;
            loadAccountOptions();
            document.getElementById('accountSelect').value = name;
            updateUI();
            document.getElementById('newAccountName').value = '';
            document.getElementById('newAccountCash').value = '';
        }

        function switchAccount() {
            currentAccount = document.getElementById('accountSelect').value;
            if (currentAccount) updateUI();
            else clearUI();
        }

        function addCash() {
            if (!currentAccount) return alert("Select an account first.");
            let amt = parseFloat(document.getElementById('addCashAmount').value);
            if (isNaN(amt)) return alert("Enter valid amount.");
            accounts[currentAccount].startingCash += amt;
            save(); updateUI();
            document.getElementById('addCashAmount').value = '';
        }

        function addExpense(e) {
            e.preventDefault();
            if (!currentAccount) return alert("Select an account.");
            const date = document.getElementById('date').value;
            const desc = document.getElementById('description').value;
            const amt = parseFloat(document.getElementById('amount').value);
            if (!date || !desc || isNaN(amt)) return alert("Fill fields correctly.");
            accounts[currentAccount].expenses.push({ date, description: desc, amount: amt });
            save(); updateUI();
            e.target.reset();
        }

        function resetRecent() {
            if (!currentAccount) return alert("Select an account.");
            if (!confirm("Reset only expenses?")) return;
            accounts[currentAccount].expenses = [];
            save(); updateUI();
        }

        function resetAll() {
            if (!currentAccount) return alert("Select an account.");
            if (!confirm("Reset ALL (balance & expenses)?")) return;
            accounts[currentAccount] = { startingCash: 0, expenses: [] };
            save(); updateUI();
        }

        function deleteAccount() {
            if (!currentAccount) return alert("Select an account.");
            if (!confirm(`Delete account ${currentAccount}?`)) return;
            delete accounts[currentAccount];
            currentAccount = null;
            save(); loadAccountOptions();
        }

        function updateUI() {
            updateTable();
            updateSummary();
        }

        function clearUI() {
            document.getElementById('expenseTable').innerHTML = '';
            document.getElementById('totalSpent').textContent = '0.00';
            document.getElementById('remaining').textContent = '0.00';
        }

        function updateTable() {
            const tbody = document.getElementById('expenseTable');
            tbody.innerHTML = '';
            accounts[currentAccount].expenses.forEach(exp => {
                tbody.innerHTML += `<tr><td>${exp.date}</td><td>${exp.description}</td><td>â‚±${exp.amount.toFixed(2)}</td></tr>`;
            });
        }

        function updateSummary() {
            const spent = accounts[currentAccount].expenses.reduce((s,e)=>s+e.amount,0);
            const remain = accounts[currentAccount].startingCash - spent;
            document.getElementById('totalSpent').textContent = spent.toFixed(2);
            document.getElementById('remaining').textContent = remain.toFixed(2);
        }

        function save() {
            localStorage.setItem('accounts', JSON.stringify(accounts));
        }

        function downloadCSV() {
            let csv = "Account,Date,Description,Amount\n";
            for (let acc in accounts) {
                accounts[acc].expenses.forEach(e => {
                    csv += `${acc},${e.date},${e.description},${e.amount}\n`;
                });
            }
            let blob = new Blob([csv], {type:"text/csv"});
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "petty-cash-data.csv";
            a.click();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
        if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Petty Cash Compiler - Multi Account</title>
    <link rel="stylesheet" href="styles-new.css" />
</head>

<body>
    <h1>Petty Cash Compiler</h1>
    <p>Track expenses & balances for multiple petty cash accounts.</p>

    <div class="setup">
        <label>Select Account:</label>
        <select id="accountSelect" onchange="switchAccount()">
            <option value="">-- Select Account --</option>
        </select>
    </div>

    <div class="setup">
        <h3>Create New Account</h3>
        <input type="text" id="newAccountName" placeholder="Account name (e.g. A1)" />
        <input type="number" id="newAccountCash" placeholder="Starting cash" />
        <button onclick="createAccount()">Create Account</button>
    </div>

    <form onsubmit="addExpense(event)">
        <h3>Add Expense</h3>
        <input type="date" id="date" required />
        <input type="text" id="description" placeholder="Description" required />
        <input type="number" id="amount" placeholder="Amount" required />
        <button type="submit">Add Expense</button>
    </form>

    <div class="summary">
        <p><strong>Total Spent:</strong> ₱<span id="totalSpent">0.00</span></p>
        <p><strong>Remaining Balance:</strong> ₱<span id="remaining">0.00</span></p>
    </div>

    <div class="setup">
        <button onclick="resetAccount()" style="
            background: #e74c3c;
            color: white;
            padding: 12px;
            width: 100%;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        ">Reset Current Account</button>
    </div>

    <div class="setup">
        <h3>Add Petty Cash to Current Account</h3>
        <input type="number" id="addCashAmount" placeholder="Amount to add" />
        <button onclick="addPettyCash()" style="
            background: #27ae60;
            color: white;
            padding: 12px;
            width: 100%;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        ">Add Cash</button>
    </div>

    <table>
        <thead>
            <tr><th>Date</th><th>Description</th><th>Amount</th></tr>
        </thead>
        <tbody id="expenseTable"></tbody>
    </table>

    <button onclick="toggleDarkMode()" style="
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 15px;
        border-radius: 6px;
        border: none;
        background: #3498db;
        color: white;
        cursor: pointer;
        z-index: 1000;
    ">Toggle Dark Mode</button>

    <script>
        let accounts = JSON.parse(localStorage.getItem('accounts')) || {};
        let currentAccount = null;

        window.onload = function() {
            loadAccountOptions();
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        };

        function loadAccountOptions() {
            const select = document.getElementById('accountSelect');
            select.innerHTML = '<option value="">-- Select Account --</option>';
            for (let accountName in accounts) {
                const option = document.createElement('option');
                option.value = accountName;
                option.textContent = accountName;
                select.appendChild(option);
            }
            if (currentAccount && accounts[currentAccount]) {
                select.value = currentAccount;
                updateUI();
            }
        }

        function createAccount() {
            const name = document.getElementById('newAccountName').value.trim();
            const cash = parseFloat(document.getElementById('newAccountCash').value);

            if (!name || isNaN(cash)) {
                alert('Please provide valid account name and starting cash.');
                return;
            }

            if (accounts[name]) {
                alert('Account already exists!');
                return;
            }

            accounts[name] = {
                startingCash: cash,
                expenses: []
            };

            localStorage.setItem('accounts', JSON.stringify(accounts));
            currentAccount = name;
            loadAccountOptions();
            document.getElementById('accountSelect').value = name;
            updateUI();
            document.getElementById('newAccountName').value = '';
            document.getElementById('newAccountCash').value = '';
        }

        function switchAccount() {
            const selected = document.getElementById('accountSelect').value;
            if (selected && accounts[selected]) {
                currentAccount = selected;
                updateUI();
            } else {
                currentAccount = null;
                clearUI();
            }
        }

        function addExpense(e) {
            e.preventDefault();
            if (!currentAccount) {
                alert('Please select an account first.');
                return;
            }

            const date = document.getElementById('date').value;
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);

            if (date && description && !isNaN(amount)) {
                accounts[currentAccount].expenses.push({ date, description, amount });
                localStorage.setItem('accounts', JSON.stringify(accounts));
                updateUI();
                e.target.reset();
            } else {
                alert('Please fill all fields correctly.');
            }
        }

        function updateUI() {
            updateTable();
            updateSummary();
        }

        function clearUI() {
            document.getElementById('expenseTable').innerHTML = '';
            document.getElementById('totalSpent').textContent = '0.00';
            document.getElementById('remaining').textContent = '0.00';
        }

        function updateTable() {
            const tbody = document.getElementById('expenseTable');
            tbody.innerHTML = '';
            accounts[currentAccount].expenses.forEach(exp => {
                const row = `<tr>
                    <td>${exp.date}</td>
                    <td>${exp.description}</td>
                    <td>₱${exp.amount.toFixed(2)}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function updateSummary() {
            const totalSpent = accounts[currentAccount].expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = accounts[currentAccount].startingCash - totalSpent;
            document.getElementById('totalSpent').textContent = totalSpent.toFixed(2);
            document.getElementById('remaining').textContent = remaining.toFixed(2);
        }

        function resetAccount() {
            if (!currentAccount) {
                alert('Please select an account first.');
                return;
            }
            if (confirm(`Are you sure you want to reset account "${currentAccount}"? This will clear all expenses and set balance to 0.`)) {
                accounts[currentAccount] = {
                    startingCash: 0,
                    expenses: []
                };
                localStorage.setItem('accounts', JSON.stringify(accounts));
                updateUI();
            }
        }

        function addPettyCash() {
            if (!currentAccount) {
                alert('Please select an account first.');
                return;
            }
            const amount = parseFloat(document.getElementById('addCashAmount').value);
            if (isNaN(amount) || amount <= 0) {
                alert('Please enter a valid positive amount.');
                return;
            }
            accounts[currentAccount].startingCash += amount;
            localStorage.setItem('accounts', JSON.stringify(accounts));
            updateUI();
            document.getElementById('addCashAmount').value = '';
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Petty Cash Compiler -Phillogix,Ideasrv,Apsoft</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <h1>Petty Cash Compiler</h1>
    <p>Track expenses & balances for multiple petty cash accounts.</p>

    <div class="setup">
        <label>Select Account:</label>
        <select id="accountSelect" onchange="switchAccount()">
            <option value="">-- Select Account --</option>
        </select>
    </div>

    <div class="setup">
        <h3>Create New Account</h3>
        <input type="text" id="newAccountName" placeholder="Account name (e.g. A1)" />
        <input type="number" id="newAccountCash" placeholder="Starting cash" />
        <button onclick="createAccount()">Create Account</button>
    </div>

    <form onsubmit="addExpense(event)">
        <h3>Add Expense</h3>
        <input type="date" id="date" required />
        <input type="text" id="description" placeholder="Description" required />
        <input type="number" id="amount" placeholder="Amount" required />
        <button type="submit">Add Expense</button>
    </form>

    <div class="summary">
        <p><strong>Total Spent:</strong> ₱<span id="totalSpent">0.00</span></p>
        <p><strong>Remaining Balance:</strong> ₱<span id="remaining">0.00</span></p>
    </div>

    <div class="setup">
        <h3>Account Options</h3>
        <button onclick="resetLastExpense()">Reset Last Expense</button>
        <button onclick="resetAccount()">Reset Whole Account</button>
    </div>

    <table>
        <thead>
            <tr><th>Date</th><th>Description</th><th>Amount</th></tr>
        </thead>
        <tbody id="expenseTable"></tbody>
    </table>

    <script>
        let accounts = JSON.parse(localStorage.getItem('accounts')) || {};
        let currentAccount = null;

        window.onload = function() {
            loadAccountOptions();
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        };

        function loadAccountOptions() {
            const select = document.getElementById('accountSelect');
            select.innerHTML = '<option value="">-- Select Account --</option>';
            for (let name in accounts) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            }
            if (currentAccount && accounts[currentAccount]) {
                select.value = currentAccount;
                updateUI();
            }
        }

        function createAccount() {
            const name = document.getElementById('newAccountName').value.trim();
            const cash = parseFloat(document.getElementById('newAccountCash').value);

            if (!name || isNaN(cash)) {
                alert('Please provide valid account name and starting cash.');
                return;
            }
            if (accounts[name]) {
                alert('Account already exists!');
                return;
            }

            accounts[name] = { startingCash: cash, expenses: [] };
            localStorage.setItem('accounts', JSON.stringify(accounts));
            currentAccount = name;
            loadAccountOptions();
            document.getElementById('accountSelect').value = name;
            updateUI();
            document.getElementById('newAccountName').value = '';
            document.getElementById('newAccountCash').value = '';
        }

        function switchAccount() {
            const selected = document.getElementById('accountSelect').value;
            currentAccount = accounts[selected] ? selected : null;
            currentAccount ? updateUI() : clearUI();
        }

        function addExpense(e) {
            e.preventDefault();
            if (!currentAccount) {
                alert('Please select an account first.');
                return;
            }
            const date = document.getElementById('date').value;
            const desc = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);

            if (date && desc && !isNaN(amount)) {
                accounts[currentAccount].expenses.push({ date, description: desc, amount });
                localStorage.setItem('accounts', JSON.stringify(accounts));
                updateUI();
                e.target.reset();
            } else {
                alert('Please fill all fields correctly.');
            }
        }

        function updateUI() {
            updateTable();
            updateSummary();
        }

        function clearUI() {
            document.getElementById('expenseTable').innerHTML = '';
            document.getElementById('totalSpent').textContent = '0.00';
            document.getElementById('remaining').textContent = '0.00';
        }

        function updateTable() {
            const tbody = document.getElementById('expenseTable');
            tbody.innerHTML = '';
            accounts[currentAccount].expenses.forEach(exp => {
                tbody.innerHTML += `<tr>
                    <td>${exp.date}</td>
                    <td>${exp.description}</td>
                    <td>₱${exp.amount.toFixed(2)}</td>
                </tr>`;
            });
        }

        function updateSummary() {
            const total = accounts[currentAccount].expenses.reduce((sum, e) => sum + e.amount, 0);
            const remain = accounts[currentAccount].startingCash - total;
            document.getElementById('totalSpent').textContent = total.toFixed(2);
            document.getElementById('remaining').textContent = remain.toFixed(2);
        }

        function resetLastExpense() {
            if (!currentAccount || accounts[currentAccount].expenses.length === 0) return;
            if (confirm("Are you sure you want to remove the most recent expense?")) {
                accounts[currentAccount].expenses.pop();
                localStorage.setItem('accounts', JSON.stringify(accounts));
                updateUI();
            }
        }

        function resetAccount() {
            if (!currentAccount) return;
            if (confirm("Are you sure you want to clear ALL expenses and reset balance?")) {
                accounts[currentAccount].expenses = [];
                localStorage.setItem('accounts', JSON.stringify(accounts));
                updateUI();
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
    </script>

    <button onclick="toggleDarkMode()" class="toggle-dark-mode-btn">Toggle Dark Mode</button>
</body>
</html>
